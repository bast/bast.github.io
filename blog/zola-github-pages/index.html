<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/ico/favicon.ico">

    <title>Radovan Bast | Home Sweet Home</title>

    
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:image" content="https://bast.fr/img/avatar.jpg" />
    

    
      <meta name="description" content="" />
      <meta name="twitter:description" content="" />
    

    
      <meta name="twitter:title" content="Using Zola (and other static site generators) with GitHub Pages without the need for an access token" />
    

    <link href="https://fonts.googleapis.com/css?family=Archivo+Narrow" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" integrity="sha256-UXesixbeLkB/UYxVTzuj/gg3+LMzgwAmg3zD+C4ZASQ=" crossorigin="anonymous">

    <link href="/css/style.css" rel="stylesheet">
  </head>

  <body>

    <div class="ui container bottom-buffer">
      <div class="ui secondary pointing stackable menu">
        <div class="right menu">
          
            <a class="item" href="/" id="fonts">Home</a>
          
            <a class="item" href="/about/" id="fonts">About</a>
          
            <a class="item" href="/projects/" id="fonts">Projects</a>
          
            <a class="item" href="/publications/" id="fonts">Publications</a>
          
            <a class="item" href="/blog/" id="fonts">Blog</a>
          
            <a class="item" href="/bookmarks/" id="fonts">Bookmarks</a>
          
        </div>
      </div>

      <div class="top-buffer">
        


        
  <div class="post">
    <h1 class="ui orange header">Using Zola (and other static site generators) with GitHub Pages without the need for an access token</h1>
    September 19, 2020

    <div class="top-buffer">
      <h2 id="moving-from-jekyll-to-zola">Moving from Jekyll to Zola</h2>
<p>There are many static site generators:
<a href="https://jekyllrb.com/">Jekyll</a>,
<a href="https://jaspervdj.be/hakyll/">Hakyll</a>,
<a href="https://gohugo.io/">Hugo</a>,
<a href="https://hexo.io/">Hexo</a>,
<a href="https://www.getlektor.com/">Lector</a>,
<a href="https://www.sphinx-doc.org/">Sphinx</a>,
<a href="https://www.mkdocs.org/">MkDocs</a>,
<a href="https://www.gitbook.com/">GitBook</a>,
<a href="https://blog.getpelican.com/">Pelican</a>,
<a href="https://www.11ty.dev/">11ty</a>,
<a href="https://www.getzola.org/">Zola</a>,
and many others.</p>
<p>I have used Jekyll for many years in many projects and one of the reasons why
it is so popular is that it is supported by <a href="https://pages.github.com/">GitHub
Pages</a> out of the box, without doing any extra
steps.  This makes it comparably simple to deploy blogs, homepages, and project
websites without running own web servers.</p>
<p>But recently I started exploring alternatives to Jekyll because it felt like
not a perfect fit for what I wanted to do. I often felt I am pressing something
else than a blog into a framework designed for blogs.  I was looking for
a framework where I can more easily customize things, where I achieve a better
separation between content and form, and where I know the underlying language
better.</p>
<p>In the recent weeks have tested many of the above tools and really liked Hugo
but my favorite static site generator at the moment is
<a href="https://www.getzola.org/">Zola</a>, and I have migrated already few projects to
Zola.  Zola really stood out, offers super fast build and rebuild, easy
installation, a link checker, clever image processing, shortcodes (reusable
macros), and much more. Overall the folder layout and the scaffold structure
maps better to how I think about a website.</p>
<p>What I wanted to find out is: <strong>how can I use
Zola on GitHub Pages with the same ease as Jekyll: commit and push files and
that's it</strong>.</p>
<h2 id="deploying-to-github-pages-using-github-actions-and-using-a-personal-access-token">Deploying to GitHub Pages using GitHub Actions and using a personal access token</h2>
<p>I was following
<a href="https://www.getzola.org/documentation/deployment/github-pages/#github-actions">this recipe</a>
until now.</p>
<p>The approach described there requires creating a personal access token and
storing it as a <em>secret</em>.  This is not difficult and it only takes 2 minutes to
set up but I was never fully happy with this solution because of the
bus/lottery factor (how many persons have to be run over by a bus or win the
lottery for a project to become unmaintained). I wanted to create open source
websites which anybody can contribute to and which do not depend on me creating
and maintaining access tokens now or in future.</p>
<h2 id="how-to-build-the-page-without-creating-a-personal-access-token">How to build the page without creating a personal access token</h2>
<p>It is indeed possible! And the approach described here should work for many of
the mentioned static site generators (I am using this not only for Zola but
also for pages built with Sphinx).</p>
<p>All you need to do is to add (and adapt, more about this later) the file
<code>.github/workflows/build.yml</code> to your GitHub repository with the following content:</p>
<pre style="background-color:#f5f5f5;">
<code><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">Build website

</span><span style="color:#b3933a;">on</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">push</span><span style="color:#1f1f1f;">:
    </span><span style="color:#7f902a;">branches</span><span style="color:#1f1f1f;">:
      - </span><span style="color:#7f902a;">source
  pull_request</span><span style="color:#1f1f1f;">:
    </span><span style="color:#7f902a;">branches</span><span style="color:#1f1f1f;">:
      - </span><span style="color:#7f902a;">source

jobs</span><span style="color:#1f1f1f;">:
  </span><span style="color:#7f902a;">build</span><span style="color:#1f1f1f;">:
    </span><span style="color:#7f8989;"># we use mac because zola is not distributed in ubuntu (?)
    # and I did not want to cargo build zola as part of the workflow
    </span><span style="color:#7f902a;">runs-on</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">macos-10.15
    if</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">github.ref == &#39;refs/heads/source&#39;
    env</span><span style="color:#1f1f1f;">:
      </span><span style="color:#7f902a;">TARGET_BRANCH</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">master
    steps</span><span style="color:#1f1f1f;">:
    - </span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">Check out repo
      uses</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">actions/checkout@v2
    </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">Install zola
      run</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">brew install zola
    </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">Generate HTML
      run</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">zola build
    </span><span style="color:#1f1f1f;">- </span><span style="color:#7f902a;">name</span><span style="color:#1f1f1f;">: </span><span style="color:#7f902a;">Commit and push to target branch
      run</span><span style="color:#1f1f1f;">: </span><span style="color:#72ab00;">|</span><span style="color:#668f14;">-
</span><span style="color:#d07711;">        git config --global user.email &quot;workflow-bot@example.com&quot;
        git config --global user.name &quot;workflow-bot&quot;
        git checkout --orphan $TARGET_BRANCH
        git rm --cached -r .
        mv public ..
        rm -rf *
        mv ../public/* .
        touch .nojekyll
        git add .
        git commit -m &quot;generated using zola build&quot;
        git push --set-upstream origin $TARGET_BRANCH --force
</span></code></pre>
<p>You may need to adapt the source branch (this is where the Zola sources are; in
this example: <code>source</code>, mentioned three times) and the target branch (this is
the branch which contains the generated HTML and is used by GitHub Pages; in
this example: <code>TARGET_BRANCH: master</code>).</p>
<p>This workflow creates a new target branch every time the source branch is
modified.</p>
<ul>
<li>
<p>The target branch is <code>master</code> for homepages or project pages of the form
<code>github.com/myuser/myuser.github.io</code> and
<code>github.com/myproject/myproject.github.io</code>.</p>
</li>
<li>
<p>For project pages of the form <code>github.com/mynamespace/myproject</code> the source
branch is typically <code>master</code> and the target branch is typically <code>gh-pages</code>.</p>
</li>
</ul>
<p>But the nice thing is that the above workflow is easily adaptable to either
situation.</p>
<p>One more question: why did I use <code>macos-10.15</code> for the build and not
<code>ubunutu-latest</code>? Because as of writing, surprisingly to me, Ubuntu does not
ship Zola (<a href="https://www.getzola.org/documentation/getting-started/installation/">many other distributions are
supported</a>).
I did not want to build Zola from sources for every page rebuild (although it
would not have been difficult), so I went for a macOS build where I can install
Zola with a one-liner (<code>brew install zola</code>).</p>
<p>Once you adapt, commit, and push this file, all that remains is to enable
GitHub Pages under the repository settings page. That's it!</p>
<h2 id="conclusion">Conclusion</h2>
<p><a href="https://www.getzola.org/">Zola</a> is a really nice tool with great documentation - try it out!
Indeed, this website is built using Zola and
<a href="https://github.com/bast/bast.github.io/blob/source/.github/workflows/build.yml">here</a>
is the workflow that I am using to build this site.
With the above recipe setting up a Zola build is no more difficult than setting
up a Jekyll build.</p>

    </div>
  </div>

      </div>

    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js" integrity="sha256-CgSoWC9w5wNmI1aN8dIMK+6DPelUEtvDr+Bc2m/0Nx8=" crossorigin="anonymous"></script>

  </body>
</html>
